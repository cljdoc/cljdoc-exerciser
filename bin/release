#!/usr/bin/env bash

# inspired by https://github.com/lambdaisland/kaocha/blob/master/bin/release

set -euo pipefail

if [[ ! -z "$(git status --porcelain)" ]]; then
    echo "Repo is not clean."
    exit 1
fi

bin/prep_release

echo "Tagging git repo"
git tag v$(bin/generate_version)
git push --tags

echo "Deploying to clojars"
mvn deploy

echo "Update pom.xml in git repo"
git add pom.xml
git commit -m "Update versions in pom.xml"
git push
